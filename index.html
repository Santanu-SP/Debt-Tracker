<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DebtTracker</title>
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="styles.css">
    <meta name="theme-color" content="#4f46e5">
    <style>
        /* Utility for view switching */
        .view {
            display: none;
        }

        .view.active {
            display: block;
            animation: fadeIn 0.2s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(5px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>

<body>

    <div class="container">
        <!-- Header -->
        <header>
            <h1>DebtTracker</h1>
        </header>

        <!-- DASHBOARD VIEW -->
        <div id="view-dashboard" class="view active">
            <div class="card balance-card">
                <div class="label">Total Balance</div>
                <div class="amount" id="total-balance">‚Çπ0.00</div>
                <div class="label">In Bank: <span id="bank-balance">‚Çπ0.00</span></div>
            </div>

            <div class="card">
                <h2>Recent Activity</h2>
                <ul class="transaction-list" id="recent-transactions">
                    <li class="list-item" style="color: var(--text-secondary); justify-content: center;">No transactions
                        yet</li>
                </ul>
            </div>
        </div>

        <!-- FRIENDS/DEBT VIEW -->
        <div id="view-friends" class="view">
            <div class="card">
                <h2>Owed to Me</h2>
                <div style="margin-bottom: 16px;">
                    <span style="font-size: 2rem; font-weight: 700; color: var(--success);" id="total-owed">‚Çπ0.00</span>
                </div>
                <ul class="friend-list" id="friends-list">
                    <!-- Dynamic List -->
                </ul>
                <button class="btn btn-primary" onclick="showAddFriendModal()">+ Add New Friend</button>
            </div>
        </div>

        <!-- SETTINGS/SALARY VIEW -->
        <div id="view-settings" class="view">
            <div class="card">
                <h2>Salary Settings</h2>
                <div class="input-group">
                    <label>Monthly Salary</label>
                    <input type="number" id="salary-input" placeholder="0.00">
                </div>
                <!-- Salary Date Selection -->
                <div class="input-group">
                    <label>Salary Date (Day of Month)</label>
                    <select id="salary-date">
                        <!-- Options 1-31 generated by JS -->
                    </select>
                </div>
                <button class="btn btn-primary" id="save-salary-btn">Save Salary Config</button>
            </div>
            <div class="card">
                <h2>Data</h2>
                <button class="btn btn-danger" onclick="clearAllData()">Reset All Data</button>
            </div>
        </div>
    </div>

    <!-- Floating Action Button for Transactions -->
    <button class="fab" id="add-transaction-btn" onclick="showTransactionModal()">+</button>

    <!-- Bottom Navigation -->
    <nav class="bottom-nav">
        <a href="#" class="nav-item active" data-target="view-dashboard" onclick="switchView('view-dashboard', this)">
            <span class="nav-icon">üè†</span>
            <span>Home</span>
        </a>
        <a href="#" class="nav-item" data-target="view-friends" onclick="switchView('view-friends', this)">
            <span class="nav-icon">üë•</span>
            <span>Friends</span>
        </a>
        <a href="#" class="nav-item" data-target="view-settings" onclick="switchView('view-settings', this)">
            <span class="nav-icon">‚öôÔ∏è</span>
            <span>Settings</span>
        </a>
    </nav>

    <!-- MODALS (Hidden by default) -->
    <!-- Add Transaction Modal -->
    <div id="modal-transaction"
        style="display:none; position:fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.5); z-index:200; align-items:flex-end;">
        <div
            style="background:var(--card-bg); border-top-left-radius:16px; border-top-right-radius:16px; padding:24px; width:100%; animation: slideUp 0.3s ease;">
            <h2>New Transaction</h2>
            <div class="input-group">
                <label>Description</label>
                <input type="text" id="t-desc" placeholder="e.g. Lunch">
            </div>
            <div class="input-group">
                <label>Amount</label>
                <input type="number" id="t-amount" placeholder="0.00">
            </div>
            <div class="input-group">
                <label>Type</label>
                <select id="t-type">
                    <option value="expense">Expense</option>
                    <option value="income">Income</option>
                    <option value="lend">Lend to Friend</option>
                    <option value="split">Split Bill</option>
                </select>
            </div>
            <div class="input-group" id="friend-selector-group" style="display:none;">
                <label>Select Friend</label>
                <select id="t-friend-select">
                    <!-- Populated by JS -->
                </select>
            </div>

            <!-- Split UI -->
            <div class="input-group" id="split-selector-group" style="display:none;">
                <label style="margin-bottom:8px; display:block;">Select Participants</label>
                <div
                    style="border:1px solid #e5e7eb; padding:8px; border-radius:12px; max-height:150px; overflow-y:auto;">
                    <div
                        style="display:flex; align-items:center; margin-bottom:8px; border-bottom:1px solid #eee; padding-bottom:4px;">
                        <input type="checkbox" id="split-include-me" checked style="width:20px; margin-right:8px;">
                        <label for="split-include-me" style="margin:0; font-weight:600;">Me (Payer)</label>
                    </div>
                    <div id="split-friends-list">
                        <!-- Checkboxes populated by JS -->
                    </div>
                </div>
            </div>
            <div style="display:flex; gap:12px; margin-top:20px;">
                <button class="btn" style="background:#e5e7eb; color:#333;" onclick="closeModals()">Cancel</button>
                <button class="btn btn-primary" onclick="addTransaction()">Save</button>
            </div>
        </div>
    </div>

    <!-- Add Friend Modal -->
    <div id="modal-friend"
        style="display:none; position:fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.5); z-index:200; align-items:center; justify-content:center;">
        <div style="background:var(--card-bg); border-radius:16px; padding:24px; width:90%; max-width:400px;">
            <h2>Add Friend</h2>
            <div class="input-group">
                <label>Name</label>
                <input type="text" id="f-name" placeholder="Name">
            </div>
            <div style="display:flex; gap:12px; margin-top:20px;">
                <button class="btn" style="background:#e5e7eb; color:#333;" onclick="closeModals()">Cancel</button>
                <button class="btn btn-primary" onclick="addFriend()">Add</button>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
    <script>
        // Inline UI logic to avoid FOUC or simple interactions before app.js loads
        function switchView(viewId, navEl) {
            // Hide all views
            document.querySelectorAll('.view').forEach(el => el.classList.remove('active'));
            // Show target view
            document.getElementById(viewId).classList.add('active');

            // Update Nav
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            navEl.classList.add('active');

            // Toggle FAB visibility (only on dashboard)
            const fab = document.getElementById('add-transaction-btn');
            if (viewId === 'view-dashboard') fab.style.display = 'flex';
            else fab.style.display = 'none';
        }

        function closeModals() {
            document.getElementById('modal-transaction').style.display = 'none';
            document.getElementById('modal-friend').style.display = 'none';
        }

        function showTransactionModal() {
            const modal = document.getElementById('modal-transaction');
            modal.style.display = 'flex';

            const typeSelect = document.getElementById('t-type');

            // Define handler (named so we can remove it if needed, though simpler here to just overwrite or exist)
            function handleTypeChange() {
                const val = typeSelect.value;
                document.getElementById('friend-selector-group').style.display = (val === 'lend') ? 'block' : 'none';
                document.getElementById('split-selector-group').style.display = (val === 'split') ? 'block' : 'none';

                if (val === 'split') {
                    // Trigger custom event for app.js to populate list if needed
                    // For now, simpler: we assume app.js populated it or we modify app.js to populate on load
                    // Let's just trigger a global refresh if it exists
                    if (typeof refreshSplitList === 'function') refreshSplitList();
                }
            }

            // Remove old listeners? Hard with anonymous functions. 
            // Better: just set onchange property to avoid stacking listeners
            typeSelect.onchange = handleTypeChange;

            // Initial State
            handleTypeChange();
        }

        function showAddFriendModal() {
            document.getElementById('modal-friend').style.display = 'flex';
        }
    </script>
</body>

</html>